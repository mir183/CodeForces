This code works differently at different compiler